import type { LoaderContext } from "../../types/config.js"

export default async function jsonLoader(
    source: string,
    sourceMap: any,
    context: LoaderContext
): Promise<string> {
    try {
        // éªŒè¯JSONæ ¼å¼
        const data = JSON.parse(source)

        // ç”ŸæˆESæ¨¡å—ä»£ç 
        const moduleCode = `
// JSON Module generated by json-loader
const data = ${JSON.stringify(data, null, 2)};

export default data;
`

        console.log(`ğŸ“„ JSONè½¬æ¢å®Œæˆ: ${context.resourcePath}`)
        return moduleCode.trim()

    } catch (error: any) {
        console.error(`âŒ JSON Loaderå¤„ç†å¤±è´¥: ${context.resourcePath}`, error)

        if (error instanceof SyntaxError) {
            throw new Error(`Invalid JSON in ${context.resourcePath}: ${error.message}`)
        }

        throw new Error(`JSON Loader failed: ${error.message}`)
    }
} 